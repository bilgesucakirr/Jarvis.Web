@page "/dashboard"
@attribute [Authorize]
@using System.Security.Claims
@using Jarvis.Web.Models
@using Jarvis.Web.Services
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Nav

<div class="container-fluid py-4">
    @if (isLoading)
    {
        <div class="text-center p-5"><div class="spinner-border text-primary"></div></div>
    }
    else
    {
        @if (userRole == "EditorInChief" || userRole == "TrackChair" || userRole == "Admin")
        {
            <div class="alert alert-primary mb-4">
                <i class="bi bi-shield-lock-fill me-2"></i> You are logged in as <strong>@userRole</strong>
            </div>

            <EditorDashboard />
        }
        else if (userRole == "Reviewer")
        {
            <div class="alert alert-info mb-4">
                <i class="bi bi-eyeglasses me-2"></i> Reviewer Dashboard
            </div>
            <p>Your pending reviews will appear here.</p>
        }
        else
        {
            <div class="mb-4">
                <h3>Welcome, Author!</h3>
                <p class="text-muted">Select a venue below to start a new submission.</p>
            </div>

            <Jarvis.Web.Components.Pages.Venues.VenueList />
        }
    }
</div>

@code {
    private string userRole = "";
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity != null && user.Identity.IsAuthenticated)
        {
            var roleClaim = user.Claims.FirstOrDefault(c => c.Type.Contains("role"));
            if (roleClaim != null)
            {
                userRole = roleClaim.Value;
            }
        }

        isLoading = false;
    }
}